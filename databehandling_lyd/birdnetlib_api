from birdnetlib import Recording
from birdnetlib.analyzer import Analyzer
from birdnetlib.batch import DirectoryMultiProcessingAnalyzer
from datetime import datetime
import pandas as pd
from pprint import pprint


def on_analyze_directory_complete(recordings):
    print("-" * 80)
    print("directory_completed: recordings processed ", len(recordings))
    print("-" * 80)

    for recording in recordings:
        print(recording.path)
        if recording.error:
            print("Error: ", recording.error_message)
        else:
            pprint(recording.detections)

        print("-" * 80)


analyzer = Analyzer()

directory = "input_lyd/"  # Point to the directory containing audio files
batch = DirectoryMultiProcessingAnalyzer(
    directory,
    analyzers=[analyzer],
    lon=15.4244,
    lat=68.5968,
    date=datetime(year=2025, month=5, day=20),
    min_conf=0.5,
)

batch.on_analyze_directory_complete = on_analyze_directory_complete
batch.process()